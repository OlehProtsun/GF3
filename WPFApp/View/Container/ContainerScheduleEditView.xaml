<UserControl x:Class="WPFApp.View.Container.ContainerScheduleEditView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d"
             d:DesignHeight="830" d:DesignWidth="852"
             Background="{StaticResource PageBackgroundBrush}">

    <Grid ClipToBounds="False">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Style="{StaticResource TopCardStyle}">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <Button Grid.Row="0"
                        HorizontalAlignment="Left"
                        Style="{StaticResource BackButtonSmallStyle}"
                        Command="{Binding CancelCommand}"
                        Width="62">
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <Viewbox Width="14" Height="14" Margin="0,0,6,0">
                            <Path Data="{StaticResource BackSvgIconGeometry}"
                                  Stretch="Uniform"
                                  Fill="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" />
                        </Viewbox>
                        <TextBlock Text="Back"
                                   Foreground="{Binding Foreground, RelativeSource={RelativeSource AncestorType=Button}}" />
                    </StackPanel>
                </Button>

                <TextBlock Grid.Row="1"
                           Margin="0,10,0,0"
                           Text="{Binding FormTitle}"
                           FontFamily="{StaticResource DefaultFontFamily}"
                           FontSize="{StaticResource FontSizePageTitle}"
                           Foreground="Black" />

                <TextBlock Grid.Row="2"
                           Margin="0,6,0,0"
                           Text="{Binding FormSubtitle}"
                           FontFamily="{StaticResource DefaultFontFamily}"
                           FontSize="17"
                           Foreground="{StaticResource SecondaryTextBrush}" />
            </Grid>
        </Border>

        <Grid Grid.Row="1" Margin="9,10,9,10">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="380" />
                <ColumnDefinition Width="10" />
                <ColumnDefinition Width="*" />
            </Grid.ColumnDefinitions>

            <Border Grid.Column="0" Style="{StaticResource CardStyle}" Padding="15">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="*" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <Viewbox Width="20" Height="20" Margin="0,0,8,0">
                            <Path Data="{StaticResource IconAvailability}"
                                  Fill="Black"
                                  Stretch="Uniform" />
                        </Viewbox>
                        <TextBlock Text="Schedule Details"
                                   FontFamily="{StaticResource DefaultFontFamily}"
                                   FontSize="{StaticResource FontSizeTitle}"
                                   FontWeight="Bold"
                                   Foreground="Black"
                                   VerticalAlignment="Center" />
                    </StackPanel>

                    <StackPanel Grid.Row="1" Margin="0,12,0,0">
                        <TextBlock Text="Schedules"
                                   FontFamily="{StaticResource DefaultFontFamily}"
                                   FontSize="12"
                                   Foreground="{StaticResource MutedTextBrush}" />
                        <StackPanel Orientation="Horizontal" Margin="0,6,0,0">
                            <ItemsControl ItemsSource="{Binding Blocks}" x:Name="ScheduleBlockList">
                                <ItemsControl.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <StackPanel Orientation="Horizontal" />
                                    </ItemsPanelTemplate>
                                </ItemsControl.ItemsPanel>
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Margin="0,0,6,0" CornerRadius="10" Background="{StaticResource SoftGrayBrush}">
                                            <StackPanel Orientation="Horizontal" Margin="6,4">
                                                <Button Style="{StaticResource RoundedButtonStyle}"
                                                        Padding="8,2"
                                                        Background="Transparent"
                                                        BorderThickness="0"
                                                        Click="ScheduleBlockSelect_Click">
                                                    <TextBlock FontSize="12">
                                                        <Run Text="Schedule" />
                                                        <Run Text=" " />
                                                        <Run Text="{Binding Model.Name}" />
                                                    </TextBlock>
                                                </Button>
                                                <Button Style="{StaticResource RoundedButtonStyle}"
                                                        Padding="4,0"
                                                        Background="Transparent"
                                                        BorderThickness="0"
                                                        IsEnabled="{Binding DataContext.CanAddBlock, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                        Click="ScheduleBlockClose_Click">
                                                    <TextBlock Text="×" FontSize="12" />
                                                </Button>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                            <Button Style="{StaticResource RoundedButtonStyle}"
                                    Padding="6,2"
                                    Margin="4,0,0,0"
                                    Command="{Binding AddBlockCommand}"
                                    IsEnabled="{Binding CanAddBlock}">
                                <TextBlock Text="＋" FontSize="12" />
                            </Button>
                        </StackPanel>
                    </StackPanel>

                    <StackPanel Grid.Row="2" Margin="0,12,0,0">
                        <TextBlock Text="Schedule ID"
                                   FontFamily="{StaticResource DefaultFontFamily}"
                                   FontSize="12"
                                   Foreground="{StaticResource MutedTextBrush}" />
                        <TextBlock Text="{Binding ScheduleId}"
                                   FontFamily="{StaticResource DefaultFontFamily}"
                                   FontSize="13"
                                   Foreground="Black" />

                        <TextBlock Text="Name"
                                   Margin="0,12,0,0"
                                   FontFamily="{StaticResource DefaultFontFamily}"
                                   FontSize="12"
                                   Foreground="{StaticResource MutedTextBrush}" />
                        <TextBox Style="{StaticResource ValidatedRoundedTextBoxStyle}"
                                 Text="{Binding ScheduleName, UpdateSourceTrigger=PropertyChanged, ValidatesOnNotifyDataErrors=True}" />

                        <TextBlock Text="Shop"
                                   Margin="0,12,0,0"
                                   FontFamily="{StaticResource DefaultFontFamily}"
                                   FontSize="12"
                                   Foreground="{StaticResource MutedTextBrush}" />
                        <Grid Margin="0,6,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="8" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBox Grid.Column="0"
                                     Style="{StaticResource CompactRoundedTextBoxWithPlaceholderStyle}"
                                     Tag="Search shops"
                                     Text="{Binding ShopSearchText, UpdateSourceTrigger=PropertyChanged}" />
                            <Button Grid.Column="2"
                                    Style="{StaticResource RoundedButtonStyle}"
                                    Width="62"
                                    Content="Find"
                                    Command="{Binding SearchShopCommand}" />
                        </Grid>
                        <ComboBox ItemsSource="{Binding Shops}"
                                  SelectedItem="{Binding SelectedShop}"
                                  DisplayMemberPath="Name"
                                  Height="33" />

                        <TextBlock Text="Availability Group"
                                   Margin="0,12,0,0"
                                   FontFamily="{StaticResource DefaultFontFamily}"
                                   FontSize="12"
                                   Foreground="{StaticResource MutedTextBrush}" />
                        <Grid Margin="0,6,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="8" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBox Grid.Column="0"
                                     Style="{StaticResource CompactRoundedTextBoxWithPlaceholderStyle}"
                                     Tag="Search availability"
                                     Text="{Binding AvailabilitySearchText, UpdateSourceTrigger=PropertyChanged}" />
                            <Button Grid.Column="2"
                                    Style="{StaticResource RoundedButtonStyle}"
                                    Width="62"
                                    Content="Find"
                                    Command="{Binding SearchAvailabilityCommand}" />
                        </Grid>
                        <ComboBox ItemsSource="{Binding AvailabilityGroups}"
                                  SelectedItem="{Binding SelectedAvailabilityGroup}"
                                  DisplayMemberPath="Name"
                                  Height="33" />

                        <Grid Margin="0,12,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="10" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <StackPanel Grid.Column="0">
                                <TextBlock Text="Month"
                                           FontFamily="{StaticResource DefaultFontFamily}"
                                           FontSize="12"
                                           Foreground="{StaticResource MutedTextBrush}" />
                                <TextBox Style="{StaticResource ValidatedRoundedTextBoxStyle}"
                                         Text="{Binding ScheduleMonth, UpdateSourceTrigger=PropertyChanged, ValidatesOnNotifyDataErrors=True}" />
                            </StackPanel>

                            <StackPanel Grid.Column="2">
                                <TextBlock Text="Year"
                                           FontFamily="{StaticResource DefaultFontFamily}"
                                           FontSize="12"
                                           Foreground="{StaticResource MutedTextBrush}" />
                                <TextBox Style="{StaticResource ValidatedRoundedTextBoxStyle}"
                                         Text="{Binding ScheduleYear, UpdateSourceTrigger=PropertyChanged, ValidatesOnNotifyDataErrors=True}" />
                            </StackPanel>
                        </Grid>

                        <TextBlock Text="People per shift"
                                   Margin="0,12,0,0"
                                   FontFamily="{StaticResource DefaultFontFamily}"
                                   FontSize="12"
                                   Foreground="{StaticResource MutedTextBrush}" />
                        <TextBox Style="{StaticResource ValidatedRoundedTextBoxStyle}"
                                 Text="{Binding SchedulePeoplePerShift, UpdateSourceTrigger=PropertyChanged, ValidatesOnNotifyDataErrors=True}" />

                        <TextBlock Text="Shift 1 (HH:mm - HH:mm)"
                                   Margin="0,12,0,0"
                                   FontFamily="{StaticResource DefaultFontFamily}"
                                   FontSize="12"
                                   Foreground="{StaticResource MutedTextBrush}" />
                        <TextBox Style="{StaticResource ValidatedRoundedTextBoxStyle}"
                                 Text="{Binding ScheduleShift1, UpdateSourceTrigger=PropertyChanged, ValidatesOnNotifyDataErrors=True}" />

                        <TextBlock Text="Shift 2 (HH:mm - HH:mm)"
                                   Margin="0,12,0,0"
                                   FontFamily="{StaticResource DefaultFontFamily}"
                                   FontSize="12"
                                   Foreground="{StaticResource MutedTextBrush}" />
                        <TextBox Style="{StaticResource ValidatedRoundedTextBoxStyle}"
                                 Text="{Binding ScheduleShift2, UpdateSourceTrigger=PropertyChanged, ValidatesOnNotifyDataErrors=True}" />

                        <TextBlock Text="Max Hours/Employee"
                                   Margin="0,12,0,0"
                                   FontFamily="{StaticResource DefaultFontFamily}"
                                   FontSize="12"
                                   Foreground="{StaticResource MutedTextBrush}" />
                        <TextBox Style="{StaticResource ValidatedRoundedTextBoxStyle}"
                                 Text="{Binding ScheduleMaxHoursPerEmp, UpdateSourceTrigger=PropertyChanged, ValidatesOnNotifyDataErrors=True}" />

                        <TextBlock Text="Max Consecutive Days"
                                   Margin="0,12,0,0"
                                   FontFamily="{StaticResource DefaultFontFamily}"
                                   FontSize="12"
                                   Foreground="{StaticResource MutedTextBrush}" />
                        <TextBox Style="{StaticResource ValidatedRoundedTextBoxStyle}"
                                 Text="{Binding ScheduleMaxConsecutiveDays, UpdateSourceTrigger=PropertyChanged}" />

                        <TextBlock Text="Max Consecutive Full"
                                   Margin="0,12,0,0"
                                   FontFamily="{StaticResource DefaultFontFamily}"
                                   FontSize="12"
                                   Foreground="{StaticResource MutedTextBrush}" />
                        <TextBox Style="{StaticResource ValidatedRoundedTextBoxStyle}"
                                 Text="{Binding ScheduleMaxConsecutiveFull, UpdateSourceTrigger=PropertyChanged}" />

                        <TextBlock Text="Max Full/Month"
                                   Margin="0,12,0,0"
                                   FontFamily="{StaticResource DefaultFontFamily}"
                                   FontSize="12"
                                   Foreground="{StaticResource MutedTextBrush}" />
                        <TextBox Style="{StaticResource ValidatedRoundedTextBoxStyle}"
                                 Text="{Binding ScheduleMaxFullPerMonth, UpdateSourceTrigger=PropertyChanged}" />

                        <TextBlock Text="Note"
                                   Margin="0,12,0,0"
                                   FontFamily="{StaticResource DefaultFontFamily}"
                                   FontSize="12"
                                   Foreground="{StaticResource MutedTextBrush}" />
                        <TextBox Style="{StaticResource ValidatedRoundedTextBoxStyle}"
                                 Height="80"
                                 AcceptsReturn="True"
                                 TextWrapping="Wrap"
                                 Text="{Binding ScheduleNote, UpdateSourceTrigger=PropertyChanged}" />
                    </StackPanel>

                    <StackPanel Grid.Row="3" Margin="0,12,0,0">
                        <TextBlock Text="Employees"
                                   FontFamily="{StaticResource DefaultFontFamily}"
                                   FontSize="12"
                                   Foreground="{StaticResource MutedTextBrush}" />

                        <Grid Margin="0,6,0,6">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="8" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <TextBox Grid.Column="0"
                                     Style="{StaticResource CompactRoundedTextBoxWithPlaceholderStyle}"
                                     Tag="Search employees"
                                     Text="{Binding EmployeeSearchText, UpdateSourceTrigger=PropertyChanged}" />
                            <Button Grid.Column="2"
                                    Style="{StaticResource RoundedButtonStyle}"
                                    Width="62"
                                    Content="Find"
                                    Command="{Binding SearchEmployeeCommand}" />
                        </Grid>

                        <Grid Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="8" />
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>

                            <ComboBox Grid.Column="0"
                                      ItemsSource="{Binding Employees}"
                                      SelectedItem="{Binding SelectedEmployee}">
                                <ComboBox.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock>
                                            <Run Text="{Binding FirstName}" />
                                            <Run Text=" " />
                                            <Run Text="{Binding LastName}" />
                                        </TextBlock>
                                    </DataTemplate>
                                </ComboBox.ItemTemplate>
                            </ComboBox>

                            <Button Grid.Column="2"
                                    Style="{StaticResource RoundedButtonStyle}"
                                    Width="70"
                                    Content="Add"
                                    Command="{Binding AddEmployeeCommand}" />
                            <Button Grid.Column="3"
                                    Style="{StaticResource RoundedButtonStyle}"
                                    Width="70"
                                    Margin="6,0,0,0"
                                    Content="Remove"
                                    Command="{Binding RemoveEmployeeCommand}" />
                        </Grid>

                        <DataGrid x:Name="dataGridScheduleEmployees"
                                  ItemsSource="{Binding ScheduleEmployees}"
                                  SelectedItem="{Binding SelectedScheduleEmployee}"
                                  Style="{StaticResource AvailabilityBaseGridStyle}"
                                  Height="160"
                                  AutoGenerateColumns="False">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="First Name" Binding="{Binding Employee.FirstName}" Width="*" />
                                <DataGridTextColumn Header="Last Name" Binding="{Binding Employee.LastName}" Width="*" />
                                <DataGridTextColumn Header="Min Hours" Binding="{Binding MinHoursMonth}" Width="100" />
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>

                    <Grid Grid.Row="4" Margin="0,16,0,0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>

                        <Button Width="84"
                                Height="33"
                                Style="{StaticResource RoundedButtonStyle}"
                                Background="{StaticResource CancelButtonBackgroundBrush}"
                                Foreground="{StaticResource MutedTextBrush}"
                                Content="Cancel"
                                Command="{Binding CancelCommand}" />

                        <Button Grid.Column="2"
                                Width="90"
                                Height="33"
                                Margin="0,0,8,0"
                                Style="{StaticResource RoundedButtonStyle}"
                                Content="Generate"
                                Command="{Binding GenerateCommand}" />

                        <Button Grid.Column="3"
                                Width="86"
                                Height="33"
                                Style="{StaticResource RoundedButtonStyle}"
                                Content="Save"
                                Command="{Binding SaveCommand}" />
                    </Grid>
                </Grid>
            </Border>

            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="*" />
                    <RowDefinition Height="10" />
                    <RowDefinition Height="*" />
                </Grid.RowDefinitions>

                <Border Grid.Row="0" Style="{StaticResource CardStyle}" Padding="12">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Viewbox Width="20" Height="20" Margin="0,0,8,0">
                                <Path Data="{StaticResource IconBind}"
                                      Fill="Black"
                                      Stretch="Uniform" />
                            </Viewbox>
                            <TextBlock Text="Schedule Matrix"
                                       FontFamily="{StaticResource DefaultFontFamily}"
                                       FontSize="{StaticResource FontSizeTitle}"
                                       FontWeight="Bold"
                                       Foreground="Black" />
                        </StackPanel>

                        <DataGrid x:Name="dataGridScheduleMatrix"
                                  Grid.Row="1"
                                  Style="{StaticResource ScheduleMatrixGridStyle}"
                                  ItemsSource="{Binding ScheduleMatrix}"
                                  AutoGenerateColumns="False"
                                  CellEditEnding="ScheduleMatrix_CellEditEnding" />
                    </Grid>
                </Border>

                <Border Grid.Row="2" Style="{StaticResource CardStyle}" Padding="12">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>

                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                            <Viewbox Width="20" Height="20" Margin="0,0,8,0">
                                <Path Data="{StaticResource IconAvailability}"
                                      Fill="Black"
                                      Stretch="Uniform" />
                            </Viewbox>
                            <TextBlock Text="Availability Preview"
                                       FontFamily="{StaticResource DefaultFontFamily}"
                                       FontSize="{StaticResource FontSizeTitle}"
                                       FontWeight="Bold"
                                       Foreground="Black" />
                        </StackPanel>

                        <DataGrid x:Name="dataGridAvailabilityPreview"
                                  Grid.Row="1"
                                  Style="{StaticResource ScheduleMatrixCompactGridStyle}"
                                  ItemsSource="{Binding AvailabilityPreviewMatrix}"
                                  AutoGenerateColumns="False"
                                  IsReadOnly="True" />
                    </Grid>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</UserControl>
